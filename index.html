<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="https://raw.githubusercontent.com/sadekhinformatique/IQRA_IMAGES/refs/heads/main/iqra%20logo%20ok.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Écoutez Radio IQRA FM en direct. La voix du saint coran." />
    <title>RADIO IQRA FM - Live Player</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & Babel for Static Runtime -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Import Map for Modules -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.344.0",
    "hls.js": "https://esm.sh/hls.js@1.5.7",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            animation: {
              'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'bounce-small': 'bounce 1s infinite',
            }
          }
        }
      }
    </script>
    <style>
      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #1e293b;
      }
      ::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 3px;
      }
      body {
        background-color: #0f172a;
        margin: 0;
      }
      .visualizer-bar {
        transition: height 0.15s ease;
      }
    </style>
  </head>
  <body class="antialiased text-slate-100 bg-slate-900">
    <div id="root"></div>

    <!-- Application Logic -->
    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { Play, Pause, Volume2, VolumeX, Loader2, Wifi, Facebook, Twitter, Instagram, Globe, Youtube, Phone } from 'lucide-react';
      import Hls from 'hls.js';

      // --- CONFIGURATION ---
      const radioConfig = {
        stationName: "RADIO IQRA FM",
        tagline: "La voix du saint coran",
        streamUrl: "https://stream.zeno.fm/ztmkyozjspltv.m3u", 
        logoUrl: "https://raw.githubusercontent.com/sadekhinformatique/IQRA_IMAGES/refs/heads/main/iqra%20logo%20ok.png",
        themeColor: "#3b82f6",
        socials: [
          { platform: 'facebook', url: 'https://facebook.com/profile.php?id=61571862830361' },
          { platform: 'twitter', url: 'https://x.com/iqra_radio4578' },
          { platform: 'instagram', url: 'https://instagram.com/radioiqratv_officielle?igsh=bTB1NDF6aGNtM3Uy' },
          { platform: 'whatsapp', url: 'https://whatsapp.com' },
          { platform: 'website', url: 'https://radioiqraburkina.com' },
          { platform: 'tiktok', url: 'https://tiktok.com/@radio.iqra.tv' },
        ]
      };

      // --- COMPONENTS ---

      // Header Component
      const Header = ({ config, isPlaying }) => {
        return (
          <div className="flex flex-col items-center justify-center space-y-6 mb-8">
            {/* Logo Container with Glow Effect */}
            <div className="relative group">
              <div className={`absolute -inset-1 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full blur opacity-25 transition duration-1000 group-hover:opacity-50 ${isPlaying ? 'opacity-60 animate-pulse-slow' : ''}`}></div>
              <div className="relative w-40 h-40 sm:w-48 sm:h-48 rounded-full overflow-hidden border-4 border-slate-800 shadow-2xl bg-slate-900 flex items-center justify-center">
                  <img 
                      src={config.logoUrl} 
                      alt={`${config.stationName} Logo`} 
                      className="w-full h-full object-cover transition-transform duration-700 hover:scale-105"
                  />
              </div>
            </div>

            {/* Text Info */}
            <div className="text-center space-y-2">
              <h1 className="text-3xl sm:text-4xl font-bold tracking-tight text-white">
                {config.stationName}
              </h1>
              <p className="text-slate-400 font-medium tracking-wide uppercase text-xs sm:text-sm">
                {config.tagline}
              </p>
            </div>

            {/* Live Indicator */}
            <div className="flex items-center space-x-2 bg-slate-800/50 px-4 py-1.5 rounded-full backdrop-blur-sm border border-slate-700/50">
              <div className={`relative flex h-3 w-3`}>
                 {isPlaying && <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>}
                 <span className={`relative inline-flex rounded-full h-3 w-3 ${isPlaying ? 'bg-red-500' : 'bg-slate-500'}`}></span>
              </div>
              <span className={`text-xs font-semibold tracking-wider ${isPlaying ? 'text-red-400' : 'text-slate-500'}`}>
                {isPlaying ? 'ON AIR' : 'OFFLINE'}
              </span>
              {isPlaying && <Wifi className="w-3 h-3 text-red-400 animate-pulse" />}
            </div>
          </div>
        );
      };

      // AudioVisualizer Component
      const AudioVisualizer = ({ isPlaying }) => {
        return (
          <div className="flex items-center justify-center h-12 space-x-1">
            {[...Array(10)].map((_, i) => (
              <div
                key={i}
                className={`w-1.5 bg-blue-500 rounded-full transition-all duration-300 ease-in-out ${
                  isPlaying ? 'animate-[bounce_1s_infinite]' : 'h-1 opacity-30'
                }`}
                style={{
                  height: isPlaying ? undefined : '4px',
                  animationDelay: `${i * 0.1}s`,
                  animationDuration: `${0.8 + Math.random() * 0.5}s`
                }}
              ></div>
            ))}
          </div>
        );
      };

      // SocialLinks Component
      const SocialLinks = ({ links }) => {
        const getIcon = (platform) => {
          switch (platform) {
            case 'facebook': return <Facebook className="w-5 h-5" />;
            case 'twitter': return <Twitter className="w-5 h-5" />;
            case 'instagram': return <Instagram className="w-5 h-5" />;
            case 'whatsapp': return <Phone className="w-5 h-5" />;
            case 'youtube': return <Youtube className="w-5 h-5" />;
            default: return <Globe className="w-5 h-5" />;
          }
        };

        if (!links || links.length === 0) return null;

        return (
          <div className="flex flex-wrap justify-center gap-4 mt-8">
            {links.map((link, index) => (
              <a
                key={index}
                href={link.url}
                target="_blank"
                rel="noopener noreferrer"
                className="p-3 bg-slate-800 text-slate-400 rounded-full hover:bg-slate-700 hover:text-white transition-all duration-300 hover:-translate-y-1 border border-slate-700 shadow-md"
                aria-label={`Visit our ${link.platform}`}
              >
                {getIcon(link.platform)}
              </a>
            ))}
          </div>
        );
      };

      // Controls Component (Main Logic)
      const Controls = ({ config, isPlaying, setIsPlaying }) => {
        const audioRef = useRef(null);
        const hlsRef = useRef(null);
        
        const [isLoading, setIsLoading] = useState(false);
        const [volume, setVolume] = useState(0.8);
        const [isMuted, setIsMuted] = useState(false);
        const [error, setError] = useState(null);

        // Helper to resolve playlist URLs
        const resolveStreamUrl = async (url) => {
          if (!url.match(/\.(m3u|pls)$/i)) {
            return url;
          }

          try {
            const response = await fetch(url);
            if (!response.ok) throw new Error('Network response was not ok');
            const text = await response.text();

            if (url.endsWith('.m3u')) {
              const lines = text.split('\n');
              for (const line of lines) {
                const trimmed = line.trim();
                if (trimmed && !trimmed.startsWith('#')) {
                  return trimmed;
                }
              }
            }

            if (url.endsWith('.pls')) {
              const match = text.match(/File1=(.+)/i);
              if (match && match[1]) {
                return match[1].trim();
              }
            }
          } catch (err) {
            console.warn("Playlist parsing failed (likely CORS), trying direct.", err);
          }
          return url;
        };

        useEffect(() => {
          if (hlsRef.current) {
            hlsRef.current.destroy();
            hlsRef.current = null;
          }
          if (audioRef.current) {
            audioRef.current.pause();
            audioRef.current.src = "";
          }

          const audio = new Audio();
          audio.crossOrigin = "anonymous";
          audio.preload = 'none';
          audioRef.current = audio;

          let isCancelled = false;

          const initAudio = async () => {
            setIsLoading(true);
            setError(null);

            try {
              const playableUrl = await resolveStreamUrl(config.streamUrl);
              
              if (isCancelled) return;

              if (Hls.isSupported() && (playableUrl.endsWith('.m3u8') || playableUrl.includes('application/vnd.apple.mpegurl'))) {
                const hls = new Hls();
                hls.loadSource(playableUrl);
                hls.attachMedia(audio);
                
                hls.on(Hls.Events.ERROR, function (event, data) {
                  if (data.fatal) {
                    console.error("HLS Error:", data);
                    setError("Erreur de flux");
                    setIsLoading(false);
                    setIsPlaying(false);
                  }
                });
                
                hlsRef.current = hls;
              } else if (audio.canPlayType('application/vnd.apple.mpegurl') && (playableUrl.endsWith('.m3u8'))) {
                audio.src = playableUrl;
              } else {
                audio.src = playableUrl;
              }

            } catch (e) {
              console.error("Init Error:", e);
              if (!isCancelled) setError("Erreur de connexion");
            }
          };

          initAudio();

          const handleWaiting = () => setIsLoading(true);
          const handleCanPlay = () => setIsLoading(false);
          const handlePlaying = () => {
              setIsLoading(false);
              setIsPlaying(true);
              setError(null);
          };
          const handleError = (e) => {
              if (audio.src === "") return;
              console.error("Audio error:", e);
              setIsLoading(false);
              setIsPlaying(false);
              setError("Flux indisponible");
          };

          audio.addEventListener('waiting', handleWaiting);
          audio.addEventListener('playing', handlePlaying);
          audio.addEventListener('canplay', handleCanPlay);
          audio.addEventListener('error', handleError);

          return () => {
            isCancelled = true;
            audio.pause();
            audio.removeEventListener('waiting', handleWaiting);
            audio.removeEventListener('playing', handlePlaying);
            audio.removeEventListener('canplay', handleCanPlay);
            audio.removeEventListener('error', handleError);
            if (hlsRef.current) {
              hlsRef.current.destroy();
            }
            audioRef.current = null;
          };
        }, [config.streamUrl, setIsPlaying]);

        useEffect(() => {
          if (audioRef.current) {
              audioRef.current.volume = isMuted ? 0 : volume;
          }
        }, [volume, isMuted]);

        const togglePlay = async () => {
          if (!audioRef.current) return;

          if (isPlaying) {
            audioRef.current.pause();
            setIsPlaying(false);
          } else {
            setIsLoading(true);
            setError(null);

            if (hlsRef.current) {
                if (error) hlsRef.current.recoverMediaError();
            } else {
                if (error || audioRef.current.error) audioRef.current.load();
            }

            try {
              await audioRef.current.play();
            } catch (err) {
              console.error("Playback failed:", err);
              setIsLoading(false);
            }
          }
        };

        const handleVolumeChange = (e) => {
          const val = parseFloat(e.target.value);
          setVolume(val);
          if (val > 0 && isMuted) setIsMuted(false);
        };

        const toggleMute = () => setIsMuted(!isMuted);

        return (
          <div className="w-full max-w-md mx-auto bg-slate-800/80 backdrop-blur-md rounded-3xl p-6 shadow-2xl border border-slate-700/50">
            
            {/* Visualizer Area */}
            <div className="h-16 mb-4 flex items-center justify-center">
              {error ? (
                  <span className="text-red-400 font-medium text-sm bg-red-900/20 px-3 py-1 rounded-full">{error}</span>
              ) : (
                  <AudioVisualizer isPlaying={isPlaying} />
              )}
            </div>

            {/* Main Play Button */}
            <div className="flex justify-center mb-8">
              <button
                onClick={togglePlay}
                className={`
                  relative flex items-center justify-center w-20 h-20 rounded-full 
                  bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-xl 
                  transition-all duration-300 hover:scale-105 hover:shadow-blue-500/25 active:scale-95
                  ${isPlaying ? 'ring-4 ring-blue-500/30' : ''}
                `}
                aria-label={isPlaying ? "Pause Radio" : "Play Radio"}
              >
                {isLoading ? (
                  <Loader2 className="w-10 h-10 animate-spin" />
                ) : isPlaying ? (
                  <Pause className="w-10 h-10 fill-current" />
                ) : (
                  <Play className="w-10 h-10 fill-current ml-1" />
                )}
              </button>
            </div>

            {/* Volume Controls */}
            <div className="flex items-center space-x-4 px-4 py-3 bg-slate-900/50 rounded-xl border border-slate-700/30">
              <button 
                  onClick={toggleMute}
                  className="text-slate-400 hover:text-white transition-colors"
              >
                {isMuted || volume === 0 ? <VolumeX size={20} /> : <Volume2 size={20} />}
              </button>
              
              <input
                type="range"
                min="0"
                max="1"
                step="0.01"
                value={isMuted ? 0 : volume}
                onChange={handleVolumeChange}
                className="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500 hover:accent-blue-400"
              />
            </div>
          </div>
        );
      };

      // --- MAIN APP COMPONENT ---
      const App = () => {
        const [isPlaying, setIsPlaying] = useState(false);

        return (
          <div className="min-h-screen bg-slate-900 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-800 via-slate-900 to-black flex items-center justify-center p-4 sm:p-6 overflow-hidden relative">
            
            {/* Background Decorative Elements */}
            <div className="absolute top-0 left-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl pointer-events-none"></div>
            <div className="absolute bottom-0 right-1/4 w-96 h-96 bg-indigo-500/10 rounded-full blur-3xl pointer-events-none"></div>
            
            {/* Main Card */}
            <main className="w-full max-w-lg z-10">
              <div className="bg-slate-900/40 backdrop-blur-xl border border-slate-700/50 rounded-3xl shadow-2xl p-6 sm:p-10">
                
                <Header config={radioConfig} isPlaying={isPlaying} />
                
                <Controls 
                  config={radioConfig} 
                  isPlaying={isPlaying} 
                  setIsPlaying={setIsPlaying}
                />
                
                <SocialLinks links={radioConfig.socials} />
                
                <footer className="mt-10 text-center text-slate-600 text-xs">
                  <p>&copy; {new Date().getFullYear()} {radioConfig.stationName}. Tous droits réservés.</p>
                </footer>
              </div>
            </main>
          </div>
        );
      };

      // --- MOUNT ---
      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>